<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.or.picsion.user.dao.UserDao">

	<select id="getPicsionList" resultType="kr.or.picsion.user.dto.User">
		SELECT * FROM USERS
	</select>
	
	<select id="userList" resultType="kr.or.picsion.user.dto.User">
		select * from  USERS
	</select>
	
	<insert id="registerUser" parameterType="kr.or.picsion.user.dto.User" useGeneratedKeys="true" keyProperty="userNo">
		INSERT INTO USERS
			(userId, pwd, userName, roleNo)
		VALUES
			( #{userId}, #{pwd}, #{userName},  1);
	</insert>
	
	<insert id="insertProfile">
		INSERT INTO PROFILE (userNo) VALUES	(#{userNo})
	</insert>
	
	<select id="selectUser" resultType="kr.or.picsion.user.dto.User">
		SELECT * FROM USERS WHERE userId= #{userId}
	</select>
	
	<!-- userNo로 회원 정보 가져오기 -->
	<select id="selectUserNo" resultType="kr.or.picsion.user.dto.User">
		SELECT * FROM USERS WHERE userNo=#{userNo}
	</select>
	
	<!-- 회원의 프로필 정보 가져오기 -->
	<select id="selectProfile" resultType="kr.or.picsion.user.dto.User">
		SELECT * FROM PROFILE WHERE userNo=#{userNo}
	</select>
	
	<!-- 회원의 팔로워 리스트 (나를 따르는 회원)-->
	<select id="followerUserList" resultType="kr.or.picsion.user.dto.User">
		SELECT f.userNo as userNo, p.prPicture, p.prContent
		FROM FOLLOW f JOIN PROFILE p
		ON f.userNo=p.userNo
		WHERE f.followingUserNo=#{userNo}
	</select>
	
	<!-- 회원의 팔로잉 리스트 (내가 따르는 회원) -->
	<select id="followingUserList" resultType="kr.or.picsion.user.dto.User">
		SELECT f.followingUserNo as userNo, p.prPicture as prPicture, p.prContent as prContent
		FROM FOLLOW f JOIN PROFILE p
		ON f.followingUserNo=p.userNo
		WHERE f.userNo=#{userNo}
	</select>
	
	<!-- 회원이 팔로잉하고 있는 회원인지 확인 -->
	<select id="followingConfirm" resultType="Integer">
		SELECT COUNT(*) FROM FOLLOW WHERE userNo=#{param1} AND followingUserNo=#{param2};
	</select>
	
	<!-- 팔로잉 insert -->
	<insert id="insertFollow">
		INSERT INTO FOLLOW VALUES(#{param1}, #{param2})
	</insert>
	
	<!-- 팔로잉 delete -->
	<delete id="deleteFollow">
		DELETE FROM FOLLOW WHERE userNo=#{param1} AND followingUserNo=#{param2};
	</delete>
	
	 <!-- 팔로잉 최신 사진 -->
    <select id="followingUserPictureList" resultType="kr.or.picsion.picture.dto.Picture">
    	SELECT f.followingUserNo as userNo, u.userName as userName, p.picNo as picNo, p.picPath as picPath, p.picReg as picReg
      	FROM USERS u join FOLLOW f on u.userNo = f.followingUserNo
                   join PICTURE p on u.userNo = p.userNo
                   where f.userNo = #{userNo}
                   order by p.picReg
    </select> 
    
    
    <!--  
     팔로잉 최신 사진의 주인 
    <select id="followingUserPictureOwnerList" resultType="kr.or.picsion.user.dto.User">
    	SELECT f.followingUserNo as userNo, u.userName as userName, p.picNo as picNo, p.picPath as picPath, p.picReg as picReg
      	FROM USERS u join FOLLOW f on u.userNo = f.followingUserNo
                   join PICTURE p on u.userNo = p.userNo
                   where f.userNo = #{userNo}
                   order by p.picReg
    </select> 
     -->
	
	
</mapper>